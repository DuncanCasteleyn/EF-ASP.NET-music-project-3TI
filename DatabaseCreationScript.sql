DECLARE @CurrentMigration [nvarchar](max)

IF object_id('[dbo].[__MigrationHistory]') IS NOT NULL
    SELECT @CurrentMigration =
        (SELECT TOP (1) 
        [Project1].[MigrationId] AS [MigrationId]
        FROM ( SELECT 
        [Extent1].[MigrationId] AS [MigrationId]
        FROM [dbo].[__MigrationHistory] AS [Extent1]
        WHERE [Extent1].[ContextKey] = N'MusicDataLayer.Migrations.Configuration'
        )  AS [Project1]
        ORDER BY [Project1].[MigrationId] DESC)

IF @CurrentMigration IS NULL
    SET @CurrentMigration = '0'

IF @CurrentMigration < '201711051128119_Deployment'
BEGIN
    CREATE TABLE [dbo].[Albums] (
        [Id] [int] NOT NULL IDENTITY,
        [Name] [nvarchar](max) NOT NULL,
        [Release] [date] NOT NULL,
        CONSTRAINT [PK_dbo.Albums] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[AlbumTracks] (
        [TrackId] [int] NOT NULL,
        [AlbumId] [int] NOT NULL,
        [TrackNumber] [int] NOT NULL,
        CONSTRAINT [PK_dbo.AlbumTracks] PRIMARY KEY ([TrackId], [AlbumId])
    )
    CREATE INDEX [IX_TrackId] ON [dbo].[AlbumTracks]([TrackId])
    CREATE INDEX [IX_AlbumId] ON [dbo].[AlbumTracks]([AlbumId])
    CREATE TABLE [dbo].[Tracks] (
        [Id] [int] NOT NULL IDENTITY,
        [Name] [nvarchar](max) NOT NULL,
        [Length] [time](7) NOT NULL,
        [Release] [date] NOT NULL,
        [NumberOfPlay] [bigint] NOT NULL,
        [TrackLocation] [nvarchar](max) NOT NULL,
        CONSTRAINT [PK_dbo.Tracks] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[Artists] (
        [Id] [int] NOT NULL IDENTITY,
        [Name] [nvarchar](max) NOT NULL,
        [RealName] [nvarchar](max),
        [Gender] [int] NOT NULL,
        [BirthCountry] [nvarchar](max),
        CONSTRAINT [PK_dbo.Artists] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[Genres] (
        [Id] [int] NOT NULL IDENTITY,
        [Name] [nvarchar](max) NOT NULL,
        CONSTRAINT [PK_dbo.Genres] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[PlayListTracks] (
        [TrackId] [int] NOT NULL,
        [PlaylistId] [int] NOT NULL,
        [TrackNumber] [int] NOT NULL,
        CONSTRAINT [PK_dbo.PlayListTracks] PRIMARY KEY ([TrackId], [PlaylistId])
    )
    CREATE INDEX [IX_TrackId] ON [dbo].[PlayListTracks]([TrackId])
    CREATE INDEX [IX_PlaylistId] ON [dbo].[PlayListTracks]([PlaylistId])
    CREATE TABLE [dbo].[Playlists] (
        [Id] [int] NOT NULL IDENTITY,
        [Name] [nvarchar](max),
        CONSTRAINT [PK_dbo.Playlists] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[ArtistTracks] (
        [Artist_Id] [int] NOT NULL,
        [Track_Id] [int] NOT NULL,
        CONSTRAINT [PK_dbo.ArtistTracks] PRIMARY KEY ([Artist_Id], [Track_Id])
    )
    CREATE INDEX [IX_Artist_Id] ON [dbo].[ArtistTracks]([Artist_Id])
    CREATE INDEX [IX_Track_Id] ON [dbo].[ArtistTracks]([Track_Id])
    CREATE TABLE [dbo].[GenreTracks] (
        [Genre_Id] [int] NOT NULL,
        [Track_Id] [int] NOT NULL,
        CONSTRAINT [PK_dbo.GenreTracks] PRIMARY KEY ([Genre_Id], [Track_Id])
    )
    CREATE INDEX [IX_Genre_Id] ON [dbo].[GenreTracks]([Genre_Id])
    CREATE INDEX [IX_Track_Id] ON [dbo].[GenreTracks]([Track_Id])
    ALTER TABLE [dbo].[AlbumTracks] ADD CONSTRAINT [FK_dbo.AlbumTracks_dbo.Albums_AlbumId] FOREIGN KEY ([AlbumId]) REFERENCES [dbo].[Albums] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[AlbumTracks] ADD CONSTRAINT [FK_dbo.AlbumTracks_dbo.Tracks_TrackId] FOREIGN KEY ([TrackId]) REFERENCES [dbo].[Tracks] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[PlayListTracks] ADD CONSTRAINT [FK_dbo.PlayListTracks_dbo.Playlists_PlaylistId] FOREIGN KEY ([PlaylistId]) REFERENCES [dbo].[Playlists] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[PlayListTracks] ADD CONSTRAINT [FK_dbo.PlayListTracks_dbo.Tracks_TrackId] FOREIGN KEY ([TrackId]) REFERENCES [dbo].[Tracks] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[ArtistTracks] ADD CONSTRAINT [FK_dbo.ArtistTracks_dbo.Artists_Artist_Id] FOREIGN KEY ([Artist_Id]) REFERENCES [dbo].[Artists] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[ArtistTracks] ADD CONSTRAINT [FK_dbo.ArtistTracks_dbo.Tracks_Track_Id] FOREIGN KEY ([Track_Id]) REFERENCES [dbo].[Tracks] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[GenreTracks] ADD CONSTRAINT [FK_dbo.GenreTracks_dbo.Genres_Genre_Id] FOREIGN KEY ([Genre_Id]) REFERENCES [dbo].[Genres] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[GenreTracks] ADD CONSTRAINT [FK_dbo.GenreTracks_dbo.Tracks_Track_Id] FOREIGN KEY ([Track_Id]) REFERENCES [dbo].[Tracks] ([Id]) ON DELETE CASCADE
    CREATE TABLE [dbo].[__MigrationHistory] (
        [MigrationId] [nvarchar](150) NOT NULL,
        [ContextKey] [nvarchar](300) NOT NULL,
        [Model] [varbinary](max) NOT NULL,
        [ProductVersion] [nvarchar](32) NOT NULL,
        CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY ([MigrationId], [ContextKey])
    )
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201711051128119_Deployment', N'MusicDataLayer.Migrations.Configuration',  0x1F8B0800000000000400ED5D5B6FE3B8157E2FD0FF20E8A9BBC8C649A6D8B681BD8B59CFA4083637C49945DF025A621C6129C995E820C6627F591FFA93FA174A5D28F12A92B22D7BB2C10083312F8787E77C3C3C87E4D1FCEF3FFF1DFFF81A23EF056679942613FFF4F8C4F76012A461942C26FE0A3F7DF777FFC71FFEFCA7F1E7307EF57EA1ED3E14ED48CF249FF8CF182FCF47A33C788631C88FE328C8D23C7DC2C7411A8F40988ECE4E4EFE313A3D1D4142C227B43C6F7CBF4A7014C3F207F9394D93002EF10AA0EB348428AFCB49CDACA4EADD8018E64B10C0897FBDCAA3E013C0E00AAC61E67B1F5104081733889E7C0F24498A01263C9E7FC9E10C6769B2982D4901400FEB2524ED9E00CA61CDFB79DBDC761A2767C534466D474A2A58E5388D1D099E7EA8E53212BBF792AEDFC88D48EE3391305E17B32EA537F13FA2F92AF63D71A4F329CA8A568C642B251C971D8E3CA1F8A84101014BF1E7C89BAE105E657092C015CE003AF2EE567314053FC3F543FA2B4C26C90A219637C21DA9E30A48D15D962E6186D7F7F0A9E6F832F4BD11DF6F24766CBA317DAAE95C26F8C399EFDD90C1C11CC146F5CCD46738CDE03F6102338061780730865952D080A5F0A4D185B18ABFE968046B64C9F8DE3578BD82C9023F13798257DFBB885E61484B6A0EBE24115961A413CE5650C161F7A8F7104190370313CDC08728B6A073035EA24539718162A9E8870C04BFE6BE47C8976DF2E768592DABE3B6FEB106D14596C6F729E2FA56758F0F205B404CB84B350D66E92A0B04EEC6A316AE661097D49C915CF6DA279C4B06644C2BDB961CF7C17F3348F722E8865833FA26444A4E6E56F1BCB0D24E84BA81BA39442902B510A518B6E5AB06A4822F862A5D602D6352A5B478E4161BAD1EE785B3F735F3BE05A846AD88D171EDACFFB676115100E502BF7DBA4360CD88FDFBBFF6B317576950FB3F3B9769EFEDD0714D8BD646BFEAAD19CC709463CD5E5DD63DCA8C7115F22ECDD5AA8C4C174364FD6450CD4F59A560872D97B8E12A5D99299088C8643A345834B9A24D1E6BABD8F2A6A8965854B5D9CCB32935E0E4D5943DDEADF3A159E77B08D09646EE1E8808266C9D2BBADCCA2247967F8A32FC3C4D49549EADB7CF76B7DFB4911D935C39A595EBB5204B23E4B21ECB0EEFCB71EFCBB10FDCACB629116CCA3DAC17D6B8DDC405735CC7AF25B8A53BF4DEE25B9681030B71296B5ABFA5A87CE4D49E8BBE8BA289D27F51B573F5B6F4A16F0F274B5C605D8E58EF75861CDD2CDAE7DDB2EBC7DA8DBBD3B948AECC2E7ECFA5A24261D792B2432289F638DFA274D32EF30B0416EDB58493B341286C0D934413841C5A13CDB198E1F5710D0B4B574FE102C60011967F0168457E9E48DAE35A5FB36D4FBBDBDEE2E7423675E33359C09528D9C28F799E065129322988AF0F04F9013F27A1673A1D6CBD6AF6D4F99A88335A1201122D4FFC6FA5A974506E6CB04059247AEA8B16E136F90411C4D0FB1854974B5390072094970C914EC897102302B362150334252B8440204AB06C71A224889600195817FA59DAAA82AF6604B1E6135C16504EB0411F36436B4ECD8BF19B61047999C4331E31D8EA869C7C2EA44346C721510B0D25DEB60A8D2E867458B55C05BD50A715CB00B0D34AC0666CBDF33B04EEF850596B8DD47133A3DEFA00CAC1C0A98F140D10FE5634E8D613E582341D53EA888D3B2129C27AFB59AA4F2A7736499DE3A263CFE8C5B49CB6DEEF2046C5188AF09C31F1EF4EAC8B415003D81883406C38D087CE03191B5554D705006D88D75BF9DDF46D17E8FE7DAC0EEE07C2A2463787B6E3551115E983498F36A228039F79510C5F5501FD971CD6D1535EC797228E0AB2338859E79104886D00C7FBE8120C15DD6990A9A65103D140484BC3AE7B733928F3506FF00602F4324FEA5FEF9C86EE62BC2D911196BB0539A49950BB9F09441820A914449F8830CD74CF4844745BC48DCD0C044C482BC5225214694964B84543DA59C841717D2D0BC210CB5846330CFB1652D007217622ED210BE196490108BD6F6DE15DB37CD365D90503A53F6D14628F79F3D71DF2B4F59EB6D9D766F8A5A6A463CE4AEF7A1753D61E08CAB3B772C19D9C7066428C41EB108BC9771608B2F3D98AA4A4837BB5943A3D416B5FD07A32D6DEDF2600A247B88DC3D1D48D47D573F4BA603CD2BC5B1F5F83E5324A16CC3BF6BAC49B558FD8A7DFCDDC5F78C7158D51C02151748F9A91709A8105146AC9D084D38B28CB7171683C2F9F804DC3586A26B8579A4D9A0EC67950B2CAE8BE4D9B17FF66BD38FA9AFF58B9E9B6E2BB20338A0B1FB6BCAE107705B99F572410000432C5D5C83445AB38D1FBD2FADED56507DBBF2AB1A7D03CBE63893485329DF1481080E4744B329642165E63F6FAD4DA3E37A52AED83AD66359D75E26D821356BCDA88454FA7394E66E968CF980DFCD06B6289275A71306ADF5CE37D95EDA8E77D2F63FA0C97A541CB76670CB4F3E15EE272F3E26A1C71DBBEC89590DB561D0C76A99BBD89B9AAC2E41EA64AD3F150E1DBBE53E491474BED29D1EB6C960E2DB3A7C23F426469F1350703B63ABCD9006BD5918A3BD434FDF68DB43DE9C118A659EB833F9B72D78BA1FFAE1D16F6768025D5756B60E0EAEB715BDAC07A4300A07EE65FDFF5AD2F4B3E94566DC8CD519361D76DDAA9F756ED2183324146389892C562A5949A96FAAE8319DA952BED558F1557D571871B53E29987B32EF953C3EE4D4DABC9B2D65691AA03C69E12AB486D418DAA13CB83D2A27480253669EC417390251C588DEBC323F3D718A4D3A4AA89EF11DE5FA2B038499AAD730CE3E3A2C1F1ECDF688A226281DA06D720899E2059DBE56344FFECE4F44CF8A8C3E17C606194E721521CBE495F59E03536C013DFA810A9F111AF6B6E27685FF5262F200B9E41F69718BC7EB369B66948F833D0E8F345801E52D7DF63EF2E27BFD495745D7D49C2A5D789FF5BD9E7DCBBFCD763DDEDC8BBCDC83A39F74EBCDF37CDE4B71DBAEEB6D1D09C97C80CBF1DB5F7D6F89B5E677C62382E13BAEF321844D5677BFE36C0C2554C4F91223E8F166630683025E688BB88CC351DF71D60DDB9AD5A6AEEF9AB7DF0A0CA5B7560C93117F48F0D869EC98C3BDE94B7984B38E4BE2C6720DA8EDEF63CE0DD597D16F2B697CC06E6457BBA6127B1AE230ACDEA5234364B9919C7D19DA41D37876C8FD1693F87C1DD3686DE8AEB3893D8A6DEDA61DC0447FB7DED5ADB343B70E08C3DD5BBD06113B174CF707698ECF7F6F2FBF696CCB72FD4D8EB7158D40C99AB60C8CE539E614B2F802DD2F276051DC6119199D8A9C9D1BDBAD83E7AF45749CEDED5F000525D381C8EE5D91B7C86B33D8EE8E9BAE219003CC60B34F129BE39577647D8613C6989855D2247F70467EBC8D15F7CBAC6068303E7A08DCEBE803398C97104CE9E2D4EDFFCF57D67AA5F2977AE2113D3074FFB7D7B19E7FBB544FB85D160F6C81D43434660C2DB979A0339EB4954A2229B5B9F0B5EBD7299F8E13C257AAE0EA43409BA4ACA350ED4E4EB4AED189A8C367120DD181DE42D29D3905466BFAE50B2AE4E8055A79FEBB3CF55A4D569A6DD99E9E6C474D548865C4BD588482DAAB64A378E324954A30B2D9ED85ABD562CA7C3BA546AFD748CD4D6CB030D96AF2FA7925BE6E56B72D00F361D5F4E81DDFB44D529F286947BCDA34FC591999C88634EB557CC982DDFF2946972B269CAEA37A59B6A7890092B3F08D0FD7901B386B91D81497F317E56409E2D5BBCDDC9EA956BF15E7843DD0E31D9413E9FA0FC5082FD4700F45F1238D4AF22F4D1F6F6A7ECF0C503F9613871D599FFCC8F040B79B4684914FFB55F0203CE496FDA5C264F290D16048E6813E132F91A6210120FBEB05A4F20C0A43A80795E7E6FB8FE5EECE7780EC3CBE47685972B4CA60CE339E292068B98A36BFCF2B30E3CCFE3DB65F979E16D4C81B01915CF286F939F56110A1BBE2F14F7D91A12453053BF6E2974898B572E8B7543E9264D2C09D5E26B62B007182F112196DF2633F002FBF0F6258757700182357DDFAF276256042FF6F1A7082C3210E7358DB63FF949301CC6AF3FFC1F32E72654D3720000 , N'6.1.3-40302')
END

